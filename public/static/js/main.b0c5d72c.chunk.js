(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{17:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),r=n.n(c),s=n(8),o=n.n(s),i=n(11),u=n(4),l=n(3),p=n(2);function d(){return Object(a.jsxs)("div",{className:"page__loader",children:["Mesto",Object(a.jsx)("span",{className:"dot dot_loader",children:"."})]})}var b=Object(c.memo)(d),j=n.p+"static/media/Logo_vector.c2821b38.svg";function m(){return Object(a.jsx)("header",{className:"header page__section",children:Object(a.jsx)("a",{href:"#",children:Object(a.jsx)("img",{src:j,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f",className:"header__logo"})})})}var O=Object(c.memo)(m);function f(e){var t=e.card.likes.some((function(t){return t._id===e.userId}));return Object(a.jsxs)("article",{className:"element",children:[Object(a.jsx)("img",{src:e.card.link,alt:e.card.name,className:"element__image",name:"image-button",onClick:function(){e.onCardClick(e.card)}}),Object(a.jsxs)("div",{className:"element__wrapper",children:[Object(a.jsx)("h2",{className:"element__title",onMouseMove:e.handleTipOpen,onMouseLeave:e.handleTipClose,children:e.card.name}),Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"element__button element__button_type_like-button ".concat(t?"element__button_type_black-like":""),type:"button",name:"like-button",onClick:function(){e.onCardLike(e.card._id,t)}}),Object(a.jsx)("span",{className:"element__likes",children:e.card.likes.length})]})]}),e.card.owner._id===e.userId&&Object(a.jsx)("button",{className:"element__button element__button_type_trash-button",type:"button",name:"trash-button",onClick:function(){e.onCardDelete(e.card._id)}})]})}var _=Object(c.memo)(f),h=Object(c.createContext)();function v(e){var t=Object(c.useContext)(h),n=Object(c.useState)({display:"none",top:"",left:""}),r=Object(p.a)(n,2),s=r[0],o=r[1],i=Object(c.useState)(""),u=Object(p.a)(i,2),d=u[0],b=u[1];function j(e){var t=e.clientX,n=e.clientY,a=e.target,c=a.scrollWidth,r=a.clientWidth,s=a.textContent;c>r&&(o({display:"block",top:"".concat(n+window.pageYOffset+10,"px"),left:"".concat(t+window.pageXOffset+10,"px")}),b(s))}function m(){o((function(e){return Object(l.a)(Object(l.a)({},e),{},{display:"none"})}))}return Object(a.jsxs)("main",{className:"page__section",children:[Object(a.jsxs)("section",{className:"profile",children:[Object(a.jsx)("div",{className:"profile__container",children:Object(a.jsx)("img",{src:t.avatar,className:"profile__image",name:"avatar-button",alt:"\u0410\u0432\u0430\u0442\u0430\u0440",onClick:e.onEditAvatar})}),Object(a.jsxs)("div",{className:"profile__wrapper",children:[Object(a.jsx)("h1",{className:"profile__title",onMouseMove:j,onMouseLeave:m,children:t.name}),Object(a.jsx)("button",{className:"profile__button profile__button_type_edit-button",type:"button",name:"edit-button",onClick:e.onEditProfile}),Object(a.jsx)("p",{className:"profile__subtitle",onMouseMove:j,onMouseLeave:m,children:t.about})]}),Object(a.jsx)("button",{className:"profile__button profile__button_type_add-button",type:"button",name:"add-button",onClick:e.onAddPlace})]}),e.cards.length?Object(a.jsx)("section",{className:"elements",children:e.cards.map((function(n){return Object(a.jsx)(_,{card:n,userId:t._id,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete,handleTipOpen:j,handleTipClose:m},n._id)}))}):Object(a.jsx)("div",{style:{textAlign:"center",fontSize:"20px"},children:"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442"}),Object(a.jsx)("span",{className:"tip",style:s,children:d})]})}var x=Object(c.memo)(v);function C(){return Object(a.jsx)("footer",{className:"footer page__section",children:Object(a.jsx)("p",{className:"footer__copyright",children:"\xa9 ".concat((new Date).getFullYear()," Mesto Russia")})})}var g=Object(c.memo)(C);function k(e){return Object(a.jsx)("section",{className:"popup ".concat(e.isOpen?"popup_opened":""),onMouseDown:function(t){t.target===t.currentTarget&&e.onClose()},children:Object(a.jsxs)("form",{className:"popup__container",id:e.name,name:e.name,onSubmit:e.onSubmit,noValidate:!0,children:[Object(a.jsx)("h2",{className:"popup__title",children:e.title}),e.children,Object(a.jsx)("button",{className:"popup__button popup__button_type_submit-button",type:"submit",disabled:e.isDisabled,dangerouslySetInnerHTML:{__html:e.button}}),Object(a.jsx)("button",{className:"popup__button popup__button_type_close-button",type:"button",name:"close-button",onClick:e.onClose})]})})}var y=Object(c.memo)(k);function N(e){var t=Object(c.useState)({}),n=Object(p.a)(t,2),r=n[0],s=n[1];function o(t){var n=t.target;s((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(u.a)({},n.name,n.value))})),e.handleChange(n)}return Object(c.useEffect)((function(){return e.isOpen&&s({name:"",link:""})}),[e.isOpen]),Object(a.jsx)(y,{title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"add-form",button:e.submitButton,isDisabled:e.isDisabled,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlace(r)},children:Object(a.jsxs)("fieldset",{className:"popup__wrapper",children:[Object(a.jsx)("input",{type:"text",className:"popup__input",id:"name",name:"name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",minLength:"2",maxLength:"30",pattern:"^[^\\s]+(\\s.*)?$",required:!0,value:r.name||"",onChange:o}),Object(a.jsx)("span",{className:"popup__input-error",children:e.errors.name}),Object(a.jsx)("input",{type:"url",className:"popup__input",id:"link",name:"link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",pattern:"^[^\\s]+(\\s.*)?$",required:!0,value:r.link||"",onChange:o}),Object(a.jsx)("span",{className:"popup__input-error",children:e.errors.link})]})})}var S=Object(c.memo)(N);function D(e){var t=Object(c.useRef)(),n=Object(c.useContext)(h);return Object(c.useEffect)((function(){return e.isOpen&&(t.current.value=n.avatar)}),[e.isOpen]),Object(a.jsx)(y,{title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"avatar-form",button:e.submitButton,isDisabled:e.isDisabled,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})},children:Object(a.jsxs)("fieldset",{className:"popup__wrapper",children:[Object(a.jsx)("input",{ref:t,type:"url",className:"popup__input",id:"avatar-link",name:"avatar",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440",pattern:"^[^\\s]+(\\s.*)?$",required:!0,onChange:function(t){var n=t.target;e.handleChange(n)}}),Object(a.jsx)("span",{className:"popup__input-error",children:e.errors["avatar-link"]})]})})}var L=Object(c.memo)(D);function w(e){var t=Object(c.useState)({}),n=Object(p.a)(t,2),r=n[0],s=n[1],o=Object(c.useContext)(h);function i(t){var n=t.target;s((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(u.a)({},n.name,n.value))})),e.handleChange(n)}return Object(c.useEffect)((function(){return e.isOpen&&s({name:o.name,about:o.about})}),[e.isOpen]),Object(a.jsx)(y,{title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"edit-form",button:e.submitButton,isDisabled:e.isDisabled,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser(r)},children:Object(a.jsxs)("fieldset",{className:"popup__wrapper",children:[Object(a.jsx)("input",{type:"text",className:"popup__input",id:"person",name:"name",placeholder:"\u0418\u043c\u044f",minLength:"2",maxLength:"40",pattern:"^[^\\s]+(\\s.*)?$",required:!0,value:r.name||"",onChange:i}),Object(a.jsx)("span",{className:"popup__input-error",children:e.errors.person}),Object(a.jsx)("input",{type:"text",className:"popup__input",id:"about",name:"about",placeholder:"\u041e \u0441\u0435\u0431\u0435",minLength:"2",maxLength:"200",pattern:"^[^\\s]+(\\s.*)?$",required:!0,value:r.about||"",onChange:i}),Object(a.jsx)("span",{className:"popup__input-error",children:e.errors.about})]})})}var E=Object(c.memo)(w);function M(e){var t=e.card,n=e.onClose,c=t.isOpen,r=t.currentCard;return Object(a.jsx)("section",{className:"popup ".concat(c?"popup_opened":""),onMouseDown:function(e){e.target===e.currentTarget&&n()},children:Object(a.jsxs)("figure",{className:"popup__container popup__container_type_image",children:[Object(a.jsx)("img",{src:r&&r.link,alt:r&&r.name,className:"popup__image"}),Object(a.jsx)("figcaption",{className:"popup__caption",children:r&&r.name}),Object(a.jsx)("button",{className:"popup__button popup__button_type_image-button",type:"button",name:"close-button",onClick:n})]})})}var T=Object(c.memo)(M),P=n(9),U=n(10),q=new(function(){function e(t){var n=t.baseUrl,a=t.headers;Object(P.a)(this,e),this._baseUrl=n,this._headers=a}return Object(U.a)(e,[{key:"_request",value:function(e,t,n){return fetch("".concat(this._baseUrl,"/").concat(e),{method:t,headers:this._headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}))}},{key:"getInitialCards",value:function(){return this._request("cards")}},{key:"getUserData",value:function(){return this._request("users/me")}},{key:"updateUserData",value:function(e){return this._request("users/me","PATCH",e)}},{key:"updateAvatar",value:function(e){return this._request("users/me/avatar","PATCH",e)}},{key:"addCard",value:function(e){return this._request("cards","POST",e)}},{key:"deleteCard",value:function(e){return this._request("cards/".concat(e),"DELETE")}},{key:"addLike",value:function(e){return this._request("cards/likes/".concat(e),"PUT")}},{key:"deleteLike",value:function(e){return this._request("cards/likes/".concat(e),"DELETE")}}]),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-18",headers:{authorization:"934c46c5-5482-4ae2-9c3d-a386fe87103e","Content-Type":"application/json; charset=utf-8"}});var A="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",B="\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",I="\u0414\u0430",F={"edit-form":!1,"add-form":!0,"avatar-form":!1},V={person:"",about:"","avatar-link":"",name:"",link:""};var $=function(){var e=Object(c.useState)(!0),t=Object(p.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)(!1),o=Object(p.a)(s,2),d=o[0],j=o[1],m=Object(c.useState)(!1),f=Object(p.a)(m,2),_=f[0],v=f[1],C=Object(c.useState)(!1),k=Object(p.a)(C,2),N=k[0],D=k[1],w=Object(c.useState)(!1),M=Object(p.a)(w,2),P=M[0],U=M[1],$=Object(c.useState)({isOpen:!1,currentCard:{}}),R=Object(p.a)($,2),H=R[0],J=R[1],Y=Object(c.useState)({}),z=Object(p.a)(Y,2),W=z[0],X=z[1],G=Object(c.useState)([]),K=Object(p.a)(G,2),Q=K[0],Z=K[1];Object(c.useEffect)((function(){Promise.all([q.getUserData(),q.getInitialCards()]).then((function(e){var t=Object(p.a)(e,2),n=t[0],a=t[1];X(n),Z(a)})).catch((function(e){return alert(e)})).finally((function(){return r(!1)}))}),[]);var ee=Object(c.useState)(A),te=Object(p.a)(ee,2),ne=te[0],ae=te[1],ce=Object(c.useState)(B),re=Object(p.a)(ce,2),se=re[0],oe=re[1],ie=Object(c.useState)(I),ue=Object(p.a)(ie,2),le=ue[0],pe=ue[1],de=Object(c.useState)(F),be=Object(p.a)(de,2),je=be[0],me=be[1],Oe=Object(c.useState)(V),fe=Object(p.a)(Oe,2),_e=fe[0],he=fe[1],ve=Object(c.useRef)(new Set);function xe(e){!function(e){e.setCustomValidity(""),e.validity.patternMismatch&&e.setCustomValidity("\u0422\u0435\u043a\u0441\u0442 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c\u0441\u044f \u0441 \u043f\u0440\u043e\u0431\u0435\u043b\u0430 \u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043e\u0434\u043d\u0438 \u043f\u0440\u043e\u0431\u0435\u043b\u044b")}(e),ve.current.add(e);var t=!e.form.checkValidity();me((function(n){return Object(l.a)(Object(l.a)({},n),{},Object(u.a)({},e.form.id,t))})),he((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(u.a)({},e.id,e.validationMessage))}))}var Ce=Object(c.useRef)();function ge(e){"Escape"===e.key&&ye()}function ke(){document.onkeydown=ge}function ye(){document.onkeydown="",me(F),he(V),ve.current.forEach((function(e){return e.setCustomValidity("")})),ve.current.clear(),j(!1),v(!1),D(!1),J((function(e){return Object(l.a)(Object(l.a)({},e),{},{isOpen:!1})})),U(!1)}return Object(a.jsx)(h.Provider,{value:W,children:Object(a.jsxs)("div",{className:"page",children:[n&&Object(a.jsx)(b,{}),Object(a.jsx)(O,{}),Object(a.jsx)(x,{cards:Q,onCardClick:function(e){ke(),J({isOpen:!0,currentCard:e})},onCardLike:function(e,t){t?q.deleteLike(e).then((function(t){if(t.likes.some((function(e){return e._id!==W._id}))||!t.likes.length){var n=Q.map((function(n){return n._id===e?t:n}));Z(n)}})).catch((function(e){return alert(e)})):q.addLike(e).then((function(t){if(t.likes.some((function(e){return e._id===W._id}))){var n=Q.map((function(n){return n._id===e?t:n}));Z(n)}})).catch((function(e){return alert(e)}))},onCardDelete:function(e){Ce.current=e,ke(),U(!0)},onAddPlace:function(){ke(),j(!0)},onEditProfile:function(){ke(),v(!0)},onEditAvatar:function(){ke(),D(!0)}}),Object(a.jsx)(g,{}),Object(a.jsx)(S,{isOpen:d,isDisabled:je["add-form"],submitButton:se,errors:_e,onClose:ye,handleChange:xe,onAddPlace:function(e){oe('\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 <span class ="dot">.</span>'),q.addCard(e).then((function(e){return Z([e].concat(Object(i.a)(Q)))})).catch((function(e){return alert(e)})).finally((function(){oe(B),ye()}))}}),Object(a.jsx)(E,{isOpen:_,isDisabled:je["edit-form"],submitButton:ne,errors:_e,onClose:ye,handleChange:xe,onUpdateUser:function(e){ae('\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 <span class ="dot">.</span>'),q.updateUserData(e).then((function(e){return X(e)})).catch((function(e){return alert(e)})).finally((function(){ae(A),ye()}))}}),Object(a.jsx)(L,{isOpen:N,isDisabled:je["avatar-form"],submitButton:ne,errors:_e,onClose:ye,handleChange:xe,onUpdateAvatar:function(e){ae('\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 <span class ="dot">.</span>'),q.updateAvatar(e).then((function(e){return X((function(t){return Object(l.a)(Object(l.a)({},t),{},{avatar:e.avatar})}))})).catch((function(e){return alert(e)})).finally((function(){ae(A),ye()}))}}),Object(a.jsx)(y,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b",name:"confirm-form",button:le,isOpen:P,onClose:ye,onSubmit:function(e){e.preventDefault(),pe('\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 <span class ="dot">.</span>'),q.deleteCard(Ce.current).then((function(){var e=Q.filter((function(e){return e._id!==Ce.current}));Z(e)})).catch((function(e){return alert(e)})).finally((function(){pe(I),ye()}))}}),Object(a.jsx)(T,{card:H,onClose:ye})]})})},R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,19)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))};n(17);o.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)($,{})}),document.getElementById("root")),R()}},[[18,1,2]]]);
//# sourceMappingURL=main.b0c5d72c.chunk.js.map